<html class="page" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <title>Handy</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="/resources/css/project.css"/>

</head>
<body class="page__body">
<header class="header">
    <div class="wrapper">
        <a class="logo" href="/"></a>
        <h1 class="company">Handy</h1>

        <nav class="header__nav">
            <a class="link" th:text="#{nav.about}" th:href="@{/admin}"></a>
            <span sec:authorize="isAuthenticated()">
                    <a class="link" th:text="#{label.pages.logout}" th:href="@{/logout}"></a>
            </span>
            <span sec:authorize="isAnonymous()">
                    <a href="#" class="link" id="loginLink" th:text="#{nav.login}"></a>
            </span>
            <span sec:authorize="isAnonymous()">
                   <a href="#" class="link" id="registrationLink" th:text="#{nav.registration}"></a>
            </span>
        </nav>

        <form class="form form_type_search search">
                <span class="input-control">
                    <label class="search__toggler" for="search"><i class="material-icons">search</i></label>
                    <input id="search" class="input search__input" placeholder="Чем могу помочь?"/>
                </span>
        </form>
    </div>
</header>

<div class="menu">
    <ul class="menu__list">
        <li class="menu__item" th:each="category : ${categoryServices}">
            <a class="link" th:text="${category.key.name}" href="#">
            </a>
        </li>
    </ul>
</div>

<div class="content wrapper">
    <section class="section section_size_1" th:each="category: ${categoryServices}">
        <h2 class="title" th:text="${category.key.name}"></h2>

        <div class="slider">

            <div class="slider__item" th:each="service: ${category.value}">
                <section class="card card_style_1">
                    <h3 class="card__title">
                        <p th:if="${service.account.firstName != null}" th:text="${service.account.firstName}"></p>
                        <p th:if="${service.account.lastName != null}" th:text="${service.account.lastName}"></p>
                    </h3>
                    <!--<div class="card__userpic"></div>-->

                    <div th:if="${service.account.userPicUri != null}">
                        <img class="card__userpic" th:src="@{'/resources/i/' + ${service.account.userPicUri}}"></img>
                    </div>
                    <div class="card__userpic__plhldr" th:if="${service.account.userPicUri == null}"></div>
                    <div class="card__description" th:text="${service.description}"></div>
                    <footer class="card__footer">

                        <button class="btn" type="button" th:text="#{label.order}"></button>
                    </footer>
                </section>
            </div>

        </div>
    </section>
    <div class="modal" id="loginModal" style="display: none;">
        <div class="modal__inner">
            <section class="card login">
                <h3 class="card__title" th:text="#{nav.auth}"></h3>
                <p class="text" th:text="#{nav.personal.page}"></p>
                <p id="modalAlert" th:text="#{message.badCredentials}" style="display: none;"></p>
                <div class="card__body">
                    <form name='f' action="login" onsubmit="return validate();" class="form form_type_login clearfix"
                          method='POST'>
                        <span class="control-group">
                            <label class="label" th:text="#{label.user.email}"></label>
                            <input id="username" name="username" class="input" type="email"
                                   placeholder="ivanov@innopolis.ru"/>
                        </span>

                        <span class="control-group">
                            <label class="label" th:text="#{label.user.password}"></label>
                            <input id="password" name="password" class="input" type="password" placeholder="12345"/>
                        </span>

                        <div class="form__actions">
                            <button class="btn" id="loginSubmit" type="submit" th:text="#{nav.login}"></button>
                        </div>
                    </form>
                </div>
            </section>
        </div>
    </div>
    <!--REGISTRATION-->
    <div class="modal" id="registrationModal" style="display: none;">
        <div class="modal__inner">
            <section class="card registration">
                <h3 class="card__title">Регистрация</h3>
                <p class="text">Для размещения информации о своих услугах на сайте <br/>пройдите простую регистрацию</p>
                <div class="card__body">
                    <form class="form form_type_registration clearfix" action="#" method="post">
                        <span class="control-group">
                            <label class="label">Имя</label>
                            <input class="input" type="text" name="firstName" placeholder="Введите имя"/>
                        </span>
                        <span class="control-group">
                            <label class="label">Фамилия</label>
                            <input class="input" type="text" name="lastName" placeholder="Введите фамилию"/>
                        </span>
                        <span class="control-group">
                            <label class="label">Адрес электронной почты</label>
                            <input class="input" type="email" name="email" placeholder="ivanov@innopolis.ru"/>
                        </span>

                        <span class="control-group">
                            <label class="label">Телефон</label>
                            <input class="input" name="phone" type="text" placeholder="+79998009090"/>
                        </span>
                        <span class="control-group">
                            <label class="label">Пароль</label>
                            <input class="input" type="password" name="password" placeholder="12345"/>
                        </span>

                        <div class="form__actions">
                            <button class="btn" type="submit">Зарегистрироваться</button>
                        </div>
                    </form>
                </div>
            </section>
        </div>
    </div>

</div>

<footer class="footer">
    <div class="copyright wrapper"><a class="link" href="#">Handy team</a>, 2017</div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="/resources/plugins/select/jquery.nice-select.min.js"></script>
<script src="/resources/plugins/slick/slick.min.js"></script>
<script src="/resources/js/project.js"></script>
<script>

    $(document).ready(function () {
        $("#loginLink").click(function () {
            $("#loginModal").fadeIn();

            setTimeout(function () {$(document).click(function(event) {
                if (!$(event.target).closest('section.card.login').length) {
                        if ($('#loginModal').is(":visible")) {
                            $('#loginModal').fadeOut();
                        }
                    $(this).unbind(event);
                }
            });}, 2000);

        });
        $("#registrationLink").click(function () {
            $("#registrationModal").fadeIn();

            setTimeout(function () {$(document).click(function(event) {
                if (!$(event.target).closest('section.card.registration').length) {
                        if ($('section.card.registration').is(":visible")) {
                            $('section.card.registration').fadeOut();
                        }
                    $(this).unbind(event);
                }
            });}, 2000);
        });
        var hasError = getParameterByName("authError");
        var alertContainer = $("#modalAlert");
        if (hasError == "true") {
            $("#loginModal").show();
            alertContainer.fadeIn();
        }


        $(".modal").click(function() {
            console.log("Clicked!");
        });
    });
    /*<![CDATA[*/
    function getParameterByName(name, url) {
        if (!url) {
            url = window.location.href;
        }
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
    /*]]>*/
</script>
</body>

</html>